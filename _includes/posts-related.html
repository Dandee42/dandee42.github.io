{% assign related_posts = site.posts | where_exp:"post","post != page" %}

{% assign related_posts_filtered = "" | split: "" %}
{% for post in related_posts %}
  {% if post != page.previous and post != page.next %}
    {% for tag in post.tags %}
      {% if page.tags contains tag %}
        {% assign related_posts_filtered = related_posts_filtered | push: post %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}

{% if related_posts_filtered.size > 0 %}
  <div class="related-posts">
    <h3>Související články</h3>
    <ul>
      {% for post in related_posts_filtered limit:3 %}
        <li><a href="{{ post.url | relative_url }}">{{ post.title }}</a></li>
      {% endfor %}
    </ul>
  </div>
{% endif %}