<div class="search-container">
  <input type="text" id="search-input" class="search-input" placeholder="Hledat v článcích...">
  <ul id="search-results" class="search-results"></ul>
  <button id="load-more" class="button load-more" style="display:none;">Zobrazit více výsledků</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
<script defer>
  fetch('/search.json')
    .then(response => response.json())
    .then(data => {
      const input = document.getElementById('search-input');
      const resultsList = document.getElementById('search-results');
      const loadMoreBtn = document.getElementById('load-more');

      const maxResults = 3;
      let allResults = [];
      let displayedCount = 0;
      let fuse = new Fuse(data, { keys: ['title', 'excerpt', 'tags'], threshold: 0.3 });

      function updateLoadMoreText() {
        const remaining = allResults.length - displayedCount;
        if (remaining > 0) {
          loadMoreBtn.textContent = `Zobrazit více výsledků (${remaining})`;
        } else {
          loadMoreBtn.textContent = `Zobrazit více výsledků`;
        }
      }

      function renderResults(reset = false) {
        if (reset) {
          resultsList.innerHTML = '';
          displayedCount = 0;
        }

        if (!allResults || allResults.length === 0) {
          loadMoreBtn.style.display = 'none';
          return;
        }

        const nextBatch = allResults.slice(displayedCount, displayedCount + maxResults);

        resultsList.innerHTML += nextBatch
          .map(r => `<li><a href="${r.item.url}">${r.item.title}</a></li>`)
          .join('');

        displayedCount += nextBatch.length;

        if (displayedCount < allResults.length) {
          loadMoreBtn.style.display = 'block';
          updateLoadMoreText();
        } else {
          loadMoreBtn.style.display = 'none';
        }
      }

      input.addEventListener('input', () => {
        allResults = fuse.search(input.value);
        renderResults(true);
      });

      loadMoreBtn.addEventListener('click', () => {
        renderResults(false);
      });
    });
</script>