<div class="search-container">
  <input type="text" id="search-input" class="search-input" placeholder="Hledat v ƒçl√°nc√≠ch...">
  <ul id="search-results" class="search-results"></ul>
  <button id="load-more" class="button load-more" style="display:none;">Zobrazit v√≠ce v√Ωsledk≈Ø</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
<script defer>
  fetch('/search.json')
    .then(response => response.json())
    .then(data => {
      const input = document.getElementById('search-input');
      const resultsList = document.getElementById('search-results');
      const loadMoreBtn = document.getElementById('load-more');

      const maxResults = 3;
      let allResults = [];
      let displayedCount = 0;
      const fuse = new Fuse(data, { keys: ['title', 'excerpt', 'tags'], threshold: 0.3 });

      function updateLoadMoreText() {
        const remaining = allResults.length - displayedCount;
        if (remaining > 0) {
          loadMoreBtn.textContent = `Zobrazit v√≠ce v√Ωsledk≈Ø (${remaining})`;
        } else {
          loadMoreBtn.textContent = `Zobrazit v√≠ce v√Ωsledk≈Ø`;
        }
      }

      function renderResults(reset = false) {
        if (reset) {
          resultsList.innerHTML = '';
          displayedCount = 0;
        }

        // üü° Kdy≈æ nen√≠ ≈æ√°dn√Ω v√Ωsledek
        if (!allResults || allResults.length === 0) {
          resultsList.innerHTML = '<li class="no-results">Hled√°n√≠ bylo √∫spƒõ≈°n√©‚Ä¶ a≈æ na to, ≈æe nic nena≈°lo.</li>';
          loadMoreBtn.style.display = 'none';
          return;
        }

        // üü¢ Jinak vykresli dal≈°√≠ d√°vku v√Ωsledk≈Ø
        const nextBatch = allResults.slice(displayedCount, displayedCount + maxResults);

        resultsList.innerHTML += nextBatch
          .map(r => `<li><a href="${r.item.url}">${r.item.title}</a></li>`)
          .join('');

        displayedCount += nextBatch.length;

        if (displayedCount < allResults.length) {
          loadMoreBtn.style.display = 'block';
          updateLoadMoreText();
        } else {
          loadMoreBtn.style.display = 'none';
        }
      }

      input.addEventListener('input', () => {
        const query = input.value.trim();

        if (query.length === 0) {
          // Kdy≈æ je pole pr√°zdn√© ‚Üí vyƒçisti v√Ωsledky
          resultsList.innerHTML = '';
          loadMoreBtn.style.display = 'none';
          return;
        }

        allResults = fuse.search(query);
        renderResults(true);
      });

      loadMoreBtn.addEventListener('click', () => {
        renderResults(false);
      });
    });
</script>